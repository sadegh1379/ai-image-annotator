{"version":3,"file":"video-reducer.js","names":["setIn","without","getImpliedVideoRegions","saveToHistory","state","action","copyImpliedRegions","currentVideoTime","regions","keyframes","type","duration","metadata","buttonName","toLowerCase","newTime","isPlaying","time","selectedTool"],"sources":["../../../src/Annotator/reducers/video-reducer.js"],"sourcesContent":["import { setIn, without } from 'seamless-immutable'\nimport getImpliedVideoRegions from './get-implied-video-regions'\nimport { saveToHistory } from './history-handler.js'\nexport default (function (state, action) {\n\tvar copyImpliedRegions = function copyImpliedRegions() {\n\t\treturn setIn(saveToHistory(state, 'Add Keyframe'), ['keyframes', state.currentVideoTime || 0], {\n\t\t\tregions: getImpliedVideoRegions(state.keyframes, state.currentVideoTime)\n\t\t})\n\t}\n\n\tswitch (action.type) {\n\tcase 'IMAGE_OR_VIDEO_LOADED':\n\t\t{\n\t\t\tvar duration = action.metadata.duration\n\n\t\t\tif (typeof duration === 'number') {\n\t\t\t\treturn setIn(state, ['videoDuration'], duration * 1000)\n\t\t\t}\n\t\t}\n\t\tbreak\n\tcase 'HEADER_BUTTON_CLICKED':\n\t\t{\n\t\t\tswitch (action.buttonName.toLowerCase()) {\n\t\t\tcase 'play':\n\t\t\t\treturn setIn(state, ['videoPlaying'], true)\n\n\t\t\tcase 'pause':\n\t\t\t\treturn setIn(state, ['videoPlaying'], false)\n\t\t\t}\n\t\t}\n\t\tbreak\n\tcase 'CHANGE_VIDEO_TIME':\n\t\t{\n\t\t\treturn setIn(state, ['currentVideoTime'], action.newTime)\n\t\t}\n\tcase 'CHANGE_VIDEO_PLAYING':\n\t\t{\n\t\t\treturn setIn(state, ['videoPlaying'], action.isPlaying)\n\t\t}\n\n\tcase 'DELETE_KEYFRAME':\n\t\t{\n\t\t\treturn setIn(state, ['keyframes'], without(state.keyframes, action.time))\n\t\t}\n\n\tdefault:\n\t\tbreak\n\t} // Before the user modifies regions, copy the interpolated regions over to a\n  // new keyframe\n\n\n\tif (!state.keyframes[state.currentVideoTime]) {\n\t\tswitch (action.type) {\n\t\tcase 'BEGIN_BOX_TRANSFORM':\n\t\tcase 'BEGIN_MOVE_POINT':\n\t\tcase 'BEGIN_MOVE_KEYPOINT':\n\t\tcase 'BEGIN_MOVE_POLYGON_POINT':\n\t\tcase 'ADD_POLYGON_POINT':\n\t\tcase 'SELECT_REGION':\n\t\tcase 'CHANGE_REGION':\n\t\tcase 'DELETE_REGION':\n\t\tcase 'OPEN_REGION_EDITOR':\n\t\t\treturn copyImpliedRegions()\n\n\t\tcase 'MOUSE_DOWN':\n\t\t\t{\n\t\t\t\tswitch (state.selectedTool) {\n\t\t\t\tcase 'create-point':\n\t\t\t\tcase 'create-polygon':\n\t\t\t\tcase 'create-box':\n\t\t\t\tcase 'create-keypoints':\n\t\t\t\t\treturn copyImpliedRegions()\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\tdefault:\n\t\t\tbreak\n\t\t}\n\t}\n\n\treturn state\n})"],"mappings":"AAAA,SAASA,KAAT,EAAgBC,OAAhB,QAA+B,oBAA/B;AACA,OAAOC,sBAAP,MAAmC,6BAAnC;AACA,SAASC,aAAT,QAA8B,sBAA9B;AACA,gBAAgB,UAAUC,KAAV,EAAiBC,MAAjB,EAAyB;EACxC,IAAIC,kBAAkB,GAAG,SAASA,kBAAT,GAA8B;IACtD,OAAON,KAAK,CAACG,aAAa,CAACC,KAAD,EAAQ,cAAR,CAAd,EAAuC,CAAC,WAAD,EAAcA,KAAK,CAACG,gBAAN,IAA0B,CAAxC,CAAvC,EAAmF;MAC9FC,OAAO,EAAEN,sBAAsB,CAACE,KAAK,CAACK,SAAP,EAAkBL,KAAK,CAACG,gBAAxB;IAD+D,CAAnF,CAAZ;EAGA,CAJD;;EAMA,QAAQF,MAAM,CAACK,IAAf;IACA,KAAK,uBAAL;MACC;QACC,IAAIC,QAAQ,GAAGN,MAAM,CAACO,QAAP,CAAgBD,QAA/B;;QAEA,IAAI,OAAOA,QAAP,KAAoB,QAAxB,EAAkC;UACjC,OAAOX,KAAK,CAACI,KAAD,EAAQ,CAAC,eAAD,CAAR,EAA2BO,QAAQ,GAAG,IAAtC,CAAZ;QACA;MACD;MACD;;IACD,KAAK,uBAAL;MACC;QACC,QAAQN,MAAM,CAACQ,UAAP,CAAkBC,WAAlB,EAAR;UACA,KAAK,MAAL;YACC,OAAOd,KAAK,CAACI,KAAD,EAAQ,CAAC,cAAD,CAAR,EAA0B,IAA1B,CAAZ;;UAED,KAAK,OAAL;YACC,OAAOJ,KAAK,CAACI,KAAD,EAAQ,CAAC,cAAD,CAAR,EAA0B,KAA1B,CAAZ;QALD;MAOA;MACD;;IACD,KAAK,mBAAL;MACC;QACC,OAAOJ,KAAK,CAACI,KAAD,EAAQ,CAAC,kBAAD,CAAR,EAA8BC,MAAM,CAACU,OAArC,CAAZ;MACA;;IACF,KAAK,sBAAL;MACC;QACC,OAAOf,KAAK,CAACI,KAAD,EAAQ,CAAC,cAAD,CAAR,EAA0BC,MAAM,CAACW,SAAjC,CAAZ;MACA;;IAEF,KAAK,iBAAL;MACC;QACC,OAAOhB,KAAK,CAACI,KAAD,EAAQ,CAAC,WAAD,CAAR,EAAuBH,OAAO,CAACG,KAAK,CAACK,SAAP,EAAkBJ,MAAM,CAACY,IAAzB,CAA9B,CAAZ;MACA;;IAEF;MACC;EApCD,CAPwC,CA4CtC;EACD;;;EAGD,IAAI,CAACb,KAAK,CAACK,SAAN,CAAgBL,KAAK,CAACG,gBAAtB,CAAL,EAA8C;IAC7C,QAAQF,MAAM,CAACK,IAAf;MACA,KAAK,qBAAL;MACA,KAAK,kBAAL;MACA,KAAK,qBAAL;MACA,KAAK,0BAAL;MACA,KAAK,mBAAL;MACA,KAAK,eAAL;MACA,KAAK,eAAL;MACA,KAAK,eAAL;MACA,KAAK,oBAAL;QACC,OAAOJ,kBAAkB,EAAzB;;MAED,KAAK,YAAL;QACC;UACC,QAAQF,KAAK,CAACc,YAAd;YACA,KAAK,cAAL;YACA,KAAK,gBAAL;YACA,KAAK,YAAL;YACA,KAAK,kBAAL;cACC,OAAOZ,kBAAkB,EAAzB;;YAED;cACC;UARD;;UAWA;QACA;;MAEF;QACC;IA7BD;EA+BA;;EAED,OAAOF,KAAP;AACA,CAnFD"}
{"version":3,"file":"get-implied-video-regions.js","names":["_slicedToArray","_objectSpread","emptyArr","keyframes","time","regions","keyframeTimes","Object","keys","map","a","parseInt","filter","isNaN","length","sort","b","nextKeyframeTimeIndex","findIndex","kt","t1","prevKeyframe","t2","nextKeyframe","prevRegionMap","nextRegionMap","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","region","value","id","err","return","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_region","impliedRegions","w1","w2","_loop","regionId","_ref","prev","push","highlighted","editingLabels","type","x","y","w","h","points","pp","i","newPoints","_i","_Object$entries","entries","_ref4","_ref3","pointId","prevPoint","_ret"],"sources":["../../../src/Annotator/reducers/get-implied-video-regions.js"],"sourcesContent":["/* eslint-disable no-unsafe-finally */\nimport _slicedToArray from '@babel/runtime/helpers/esm/slicedToArray'\nimport _objectSpread from '@babel/runtime/helpers/esm/objectSpread'\nvar emptyArr = []\nexport default (function (keyframes, time) {\n\tif (keyframes[time || 0]) {\n\t\treturn keyframes[time || 0].regions\n\t} // Get surrounding video keyframes\n\n\n\tvar keyframeTimes = Object.keys(keyframes).map(function (a) {\n\t\treturn parseInt(a)\n\t}).filter(function (a) {\n\t\treturn !isNaN(a)\n\t})\n\tif (keyframeTimes.length === 0) return emptyArr\n\tkeyframeTimes.sort(function (a, b) {\n\t\treturn a - b\n\t})\n\tvar nextKeyframeTimeIndex = keyframeTimes.findIndex(function (kt) {\n\t\treturn kt >= time\n\t})\n\n\tif (nextKeyframeTimeIndex === -1) {\n\t\treturn keyframes[keyframeTimes[keyframeTimes.length - 1]].regions || emptyArr\n\t} else if (nextKeyframeTimeIndex === 0) {\n\t\treturn emptyArr\n\t}\n\n\tvar t1 = keyframeTimes[nextKeyframeTimeIndex - 1]\n\tvar prevKeyframe = keyframes[t1]\n\tvar t2 = keyframeTimes[nextKeyframeTimeIndex]\n\tvar nextKeyframe = keyframes[t2]\n\tvar prevRegionMap = {},\n\t\tnextRegionMap = {}\n\tvar _iteratorNormalCompletion = true\n\tvar _didIteratorError = false\n\tvar _iteratorError = undefined\n\n\ttry {\n\t\tfor (var _iterator = prevKeyframe.regions[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\tvar region = _step.value\n\t\t\tprevRegionMap[region.id] = region\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError = true\n\t\t_iteratorError = err\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion && _iterator.return != null) {\n\t\t\t\t_iterator.return()\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError) {\n\t\t\t\tthrow _iteratorError\n\t\t\t}\n\t\t}\n\t}\n\n\tvar _iteratorNormalCompletion2 = true\n\tvar _didIteratorError2 = false\n\tvar _iteratorError2 = undefined\n\n\ttry {\n\t\tfor (var _iterator2 = nextKeyframe.regions[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\tvar _region = _step2.value\n\t\t\tnextRegionMap[_region.id] = _region\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError2 = true\n\t\t_iteratorError2 = err\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n\t\t\t\t_iterator2.return()\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError2) {\n\t\t\t\tthrow _iteratorError2\n\t\t\t}\n\t\t}\n\t}\n\n\tvar impliedRegions = [] // Weighted time coefficients for linear transition\n\n\tvar w1 = (t2 - time) / (t2 - t1)\n\tvar w2 = 1 - w1\n\n\tvar _loop = function _loop(regionId) {\n\t\tvar _ref = [prevRegionMap[regionId], nextRegionMap[regionId]],\n\t\t\tprev = _ref[0],\n\t\t\tnext = _ref[1]\n\n\t\tif (!next) {\n\t\t\timpliedRegions.push(_objectSpread({}, prev, {\n\t\t\t\thighlighted: false,\n\t\t\t\teditingLabels: false\n\t\t\t}))\n\t\t\treturn 'continue'\n\t\t}\n\n\t\tswitch (prev.type) {\n\t\tcase 'point':\n\t\t\t{\n\t\t\t\timpliedRegions.push(_objectSpread({}, prev, {\n\t\t\t\t\thighlighted: false,\n\t\t\t\t\teditingLabels: false,\n\t\t\t\t\tx: prev.x * w1 + next.x * w2,\n\t\t\t\t\ty: prev.y * w1 + next.y * w2\n\t\t\t\t}))\n\t\t\t\tbreak\n\t\t\t}\n\n\t\tcase 'box':\n\t\t\t{\n\t\t\t\timpliedRegions.push(_objectSpread({}, prev, {\n\t\t\t\t\thighlighted: false,\n\t\t\t\t\teditingLabels: false,\n\t\t\t\t\tx: prev.x * w1 + next.x * w2,\n\t\t\t\t\ty: prev.y * w1 + next.y * w2,\n\t\t\t\t\tw: prev.w * w1 + next.w * w2,\n\t\t\t\t\th: prev.h * w1 + next.h * w2\n\t\t\t\t}))\n\t\t\t\tbreak\n\t\t\t}\n\n\t\tcase 'polygon':\n\t\t\t{\n\t\t\t\tif (next.points.length === prev.points.length) {\n\t\t\t\t\timpliedRegions.push(_objectSpread({}, prev, {\n\t\t\t\t\t\thighlighted: false,\n\t\t\t\t\t\teditingLabels: false,\n\t\t\t\t\t\tpoints: prev.points.map(function (pp, i) {\n\t\t\t\t\t\t\treturn [pp[0] * w1 + next.points[i][0] * w2, pp[1] * w1 + next.points[i][1] * w2]\n\t\t\t\t\t\t})\n\t\t\t\t\t}))\n\t\t\t\t} else {\n\t\t\t\t\timpliedRegions.push(prev)\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\tcase 'keypoints':\n\t\t\t{\n\t\t\t\tvar newPoints = {}\n\n\t\t\t\tfor (var _i = 0, _Object$entries = Object.entries(prev.points); _i < _Object$entries.length; _i++) {\n\t\t\t\t\tvar _ref4 = _Object$entries[_i]\n\n\t\t\t\t\tvar _ref3 = _slicedToArray(_ref4, 2)\n\n\t\t\t\t\tvar pointId = _ref3[0]\n\t\t\t\t\tvar prevPoint = _ref3[1]\n\t\t\t\t\tnewPoints[pointId] = {\n\t\t\t\t\t\tx: prevPoint.x * w1 + next.points[pointId].x * w2,\n\t\t\t\t\t\ty: prevPoint.y * w1 + next.points[pointId].y * w2\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\timpliedRegions.push(_objectSpread({}, prev, {\n\t\t\t\t\thighlighted: false,\n\t\t\t\t\teditingLabels: false,\n\t\t\t\t\tpoints: newPoints\n\t\t\t\t}))\n\t\t\t\tbreak\n\t\t\t}\n\n\t\tdefault:\n\t\t\tbreak\n\t\t}\n\t}\n\n\tfor (var regionId in prevRegionMap) {\n\t\tvar _ret = _loop(regionId)\n\n\t\tif (_ret === 'continue') continue\n\t}\n\n\treturn impliedRegions\n})"],"mappings":"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"}
{"version":3,"file":"general-reducer.js","names":["_toConsumableArray","_slicedToArray","_objectSpread","moveRegion","getIn","setIn","updateIn","moment","isEqual","getActiveImage","saveToHistory","colors","fixTwisted","convertExpandingLineToPolygon","clamp","getLandmarksWithTransform","setInLocalStorage","getRandomId","Math","random","toString","split","state","action","allowedArea","selectedTool","includes","type","aa","x","w","y","h","cls","oldRegionClsList","regionClsList","newState","concat","Date","now","lastMouseMoveCall","_getActiveImage","currentImageIndex","pathToActiveImage","activeImage","getRegionIndex","region","regionId","id","regionIndex","regions","findIndex","r","getRegion","modifyRegion","obj","_getRegion","_getRegion2","filter","unselectRegions","map","highlighted","closeEditors","editingLabels","setNewImage","img","index","_ref","src","frameTime","image","imageIndex","oldRegion","clsIndex","indexOf","color","tags","comment","delta","_i","_Object$keys","Object","keys","length","key","_regionIndex","mode","point","box","directions","freedom","original","polygon","pointIndex","points","slice","open","_region","keypointId","_polygon","_pointIndex","_regionIndex2","splice","_state","mouseDownAt","_state$mode","_pointIndex2","_regionIndex3","_state$mode2","_keypointId","_regionId","_getRegion3","_getRegion4","_region2","_regionIndex4","_regionId2","_state2","_state2$allowedArea","_regionIndex5","_state$mode3","_regionId3","_state$mode3$freedom","xFree","yFree","_state$mode3$original","ox","oy","ow","oh","dx","min","dw","max","dy","dh","_regionIndex6","_box","_state$mode4","_regionId4","landmarks","centerX","centerY","distFromCenter","sqrt","pow","scale","center","_regionId5","_getRegion5","_getRegion6","_region3","_regionIndex7","_regionId6","_getRegion7","_getRegion8","_region4","_regionIndex8","x2","y2","_regionId7","_getRegion9","_getRegion10","expandingLine","_regionIndex9","isMouseDown","Boolean","lastPoint","mouseDistFromLastPoint","width","_newState","angle","atan2","candidatePoint","_regionId8","_getRegion11","_getRegion12","_expandingLine","_regionIndex10","_lastPoint","_state3","_mouseDownAt","_state$selectedCls","_x","_y","_getRegion13","_getRegion14","_polygon2","_regionIndex11","_getRegion15","_getRegion16","line","_regionIndex12","_getRegion17","_getRegion18","_expandingLine2","_regionIndex13","_lastPoint2","_getRegion19","_getRegion20","_expandingLine3","_regionIndex14","expandingWidth","p","undefined","newRegion","defaultRegionCls","selectedCls","defaultRegionColor","_clsIndex","editLabelEditorAfter","isNew","unfinished","x1","y1","_ref2","entries","keypointDefinitions","_ref3","_ref3$","keypointsDefinitionId","_ref3$$","_landmarks","connections","_regions","_x2","_y2","_state4","_state4$mouseDownAt","_mouseDownAt2","abs","_getRegion21","_getRegion22","_expandingLine4","_regionIndex15","newExpandingLine","_lastPoint3","jointStart","_mouseDistFromLastPoint","newPoints","i","_region5","_regionIndex16","newRegions","_region6","_regionIndex17","_regionIndex18","buttonName","toLowerCase","images","settingsOpen","showTags","showMask","_state5","_regionId9","_regions2","some"],"sources":["../../../src/Annotator/reducers/general-reducer.js"],"sourcesContent":["import _toConsumableArray from '@babel/runtime/helpers/esm/toConsumableArray'\nimport _slicedToArray from '@babel/runtime/helpers/esm/slicedToArray'\nimport _objectSpread from '@babel/runtime/helpers/esm/objectSpread'\nimport { moveRegion } from '../../ImageCanvas/region-tools.js'\nimport { getIn, setIn, updateIn } from 'seamless-immutable'\nimport moment from 'moment'\nimport isEqual from 'lodash/isEqual'\nimport getActiveImage from './get-active-image'\nimport { saveToHistory } from './history-handler.js'\nimport colors from '../../colors'\nimport fixTwisted from './fix-twisted'\nimport convertExpandingLineToPolygon from './convert-expanding-line-to-polygon'\nimport clamp from 'clamp'\nimport getLandmarksWithTransform from '../../utils/get-landmarks-with-transform'\nimport setInLocalStorage from '../../utils/set-in-local-storage'\n\nvar getRandomId = function getRandomId() {\n\treturn Math.random().toString().split('.')[1]\n}\n\nexport default (function (state, action) {\n\tif (state.allowedArea && state.selectedTool !== 'modify-allowed-area' && ['MOUSE_DOWN', 'MOUSE_UP', 'MOUSE_MOVE'].includes(action.type)) {\n\t\tvar aa = state.allowedArea\n\t\taction.x = clamp(action.x, aa.x, aa.x + aa.w)\n\t\taction.y = clamp(action.y, aa.y, aa.y + aa.h)\n\t}\n\n\tif (action.type === 'ON_CLS_ADDED' && action.cls && action.cls !== '') {\n\t\tvar oldRegionClsList = state.regionClsList\n\n\t\tvar newState = _objectSpread({}, state, {\n\t\t\tregionClsList: oldRegionClsList.concat(action.cls)\n\t\t})\n\n\t\treturn newState\n\t} // Throttle certain actions\n\n\n\tif (action.type === 'MOUSE_MOVE') {\n\t\tif (Date.now() - (state.lastMouseMoveCall || 0) < 16) return state\n\t\tstate = setIn(state, ['lastMouseMoveCall'], Date.now())\n\t}\n\n\tif (!action.type.includes('MOUSE')) {\n\t\tstate = setIn(state, ['lastAction'], action)\n\t}\n\n\tvar _getActiveImage = getActiveImage(state),\n\t\tcurrentImageIndex = _getActiveImage.currentImageIndex,\n\t\tpathToActiveImage = _getActiveImage.pathToActiveImage,\n\t\tactiveImage = _getActiveImage.activeImage\n\n\tvar getRegionIndex = function getRegionIndex(region) {\n\t\tvar regionId = typeof region === 'string' || typeof region === 'number' ? region : region.id\n\t\tif (!activeImage) return null\n\t\tvar regionIndex = (activeImage.regions || []).findIndex(function (r) {\n\t\t\treturn r.id === regionId\n\t\t})\n\t\treturn regionIndex === -1 ? null : regionIndex\n\t}\n\n\tvar getRegion = function getRegion(regionId) {\n\t\tif (!activeImage) return null\n\t\tvar regionIndex = getRegionIndex(regionId)\n\t\tif (regionIndex === null) return [null, null]\n\t\tvar region = activeImage.regions[regionIndex]\n\t\treturn [region, regionIndex]\n\t}\n\n\tvar modifyRegion = function modifyRegion(regionId, obj) {\n\t\tvar _getRegion = getRegion(regionId),\n\t\t\t_getRegion2 = _slicedToArray(_getRegion, 2),\n\t\t\tregion = _getRegion2[0],\n\t\t\tregionIndex = _getRegion2[1]\n\n\t\tif (!region) return state\n\n\t\tif (obj !== null) {\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', regionIndex]), _objectSpread({}, region, obj))\n\t\t} else {\n      // delete region\n\t\t\tvar regions = activeImage.regions\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), (regions || []).filter(function (r) {\n\t\t\t\treturn r.id !== region.id\n\t\t\t}))\n\t\t}\n\t}\n\n\tvar unselectRegions = function unselectRegions(state) {\n\t\tif (!activeImage) return state\n\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), (activeImage.regions || []).map(function (r) {\n\t\t\treturn _objectSpread({}, r, {\n\t\t\t\thighlighted: false\n\t\t\t})\n\t\t}))\n\t}\n\n\tvar closeEditors = function closeEditors(state) {\n\t\tif (currentImageIndex === null) return state\n\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), (activeImage.regions || []).map(function (r) {\n\t\t\treturn _objectSpread({}, r, {\n\t\t\t\teditingLabels: false\n\t\t\t})\n\t\t}))\n\t}\n\n\tvar setNewImage = function setNewImage(img, index) {\n\t\tvar _ref = typeof img === 'object' ? img : {\n\t\t\t\tsrc: img\n\t\t\t},\n\t\t\tsrc = _ref.src,\n\t\t\tframeTime = _ref.frameTime\n\n\t\treturn setIn(setIn(state, ['selectedImage'], index), ['selectedImageFrameTime'], frameTime)\n\t}\n\n\tswitch (action.type) {\n\tcase '@@INIT':\n\t\t{\n\t\t\treturn state\n\t\t}\n\n\tcase 'SELECT_IMAGE':\n\t\t{\n\t\t\treturn setNewImage(action.image, action.imageIndex)\n\t\t}\n\n\tcase 'SELECT_CLASSIFICATION':\n\t\t{\n\t\t\treturn setIn(state, ['selectedCls'], action.cls)\n\t\t}\n\n\tcase 'CHANGE_REGION':\n\t\t{\n\t\t\tvar regionIndex = getRegionIndex(action.region)\n\t\t\tif (regionIndex === null) return state\n\t\t\tvar oldRegion = activeImage.regions[regionIndex]\n\n\t\t\tif (oldRegion.cls !== action.region.cls) {\n\t\t\t\tstate = saveToHistory(state, 'Change Region Classification')\n\t\t\t\tvar clsIndex = state.regionClsList.indexOf(action.region.cls)\n\n\t\t\t\tif (clsIndex !== -1) {\n\t\t\t\t\tstate = setIn(state, ['selectedCls'], action.region.cls)\n\t\t\t\t\taction.region.color = action.region.cls.color\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!isEqual(oldRegion.tags, action.region.tags)) {\n\t\t\t\tstate = saveToHistory(state, 'Change Region Tags')\n\t\t\t}\n\n\t\t\tif (!isEqual(oldRegion.comment, action.region.comment)) {\n\t\t\t\tstate = saveToHistory(state, 'Change Region Comment')\n\t\t\t}\n\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', regionIndex]), action.region)\n\t\t}\n\n\tcase 'CHANGE_IMAGE':\n\t\t{\n\t\t\tif (!activeImage) return state\n\t\t\tvar delta = action.delta\n\n\t\t\tfor (var _i = 0, _Object$keys = Object.keys(delta); _i < _Object$keys.length; _i++) {\n\t\t\t\tvar key = _Object$keys[_i]\n\t\t\t\tif (key === 'cls') saveToHistory(state, 'Change Image Class')\n\t\t\t\tif (key === 'tags') saveToHistory(state, 'Change Image Tags')\n\t\t\t\tstate = setIn(state, [].concat(_toConsumableArray(pathToActiveImage), [key]), delta[key])\n\t\t\t}\n\n\t\t\treturn state\n\t\t}\n\n\tcase 'SELECT_REGION':\n\t\t{\n\t\t\tvar region = action.region\n\n\t\t\tvar _regionIndex = getRegionIndex(action.region)\n\n\t\t\tif (_regionIndex === null) return state\n\n\t\t\tvar regions = _toConsumableArray(activeImage.regions || []).map(function (r) {\n\t\t\t\treturn _objectSpread({}, r, {\n\t\t\t\t\thighlighted: r.id === region.id,\n\t\t\t\t\teditingLabels: r.id === region.id\n\t\t\t\t})\n\t\t\t})\n\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), regions)\n\t\t}\n\n\tcase 'BEGIN_MOVE_POINT':\n\t\t{\n\t\t\tstate = closeEditors(state)\n\t\t\treturn setIn(state, ['mode'], {\n\t\t\t\tmode: 'MOVE_REGION',\n\t\t\t\tregionId: action.point.id\n\t\t\t})\n\t\t}\n\n\tcase 'BEGIN_BOX_TRANSFORM':\n\t\t{\n\t\t\tvar box = action.box,\n\t\t\t\tdirections = action.directions\n\t\t\tstate = closeEditors(state)\n\n\t\t\tif (directions[0] === 0 && directions[1] === 0) {\n\t\t\t\treturn setIn(state, ['mode'], {\n\t\t\t\t\tmode: 'MOVE_REGION',\n\t\t\t\t\tregionId: box.id\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\treturn setIn(state, ['mode'], {\n\t\t\t\t\tmode: 'RESIZE_BOX',\n\t\t\t\t\tregionId: box.id,\n\t\t\t\t\tfreedom: directions,\n\t\t\t\t\toriginal: {\n\t\t\t\t\t\tx: box.x,\n\t\t\t\t\t\ty: box.y,\n\t\t\t\t\t\tw: box.w,\n\t\t\t\t\t\th: box.h\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\tcase 'BEGIN_MOVE_POLYGON_POINT':\n\t\t{\n\t\t\tvar polygon = action.polygon,\n\t\t\t\tpointIndex = action.pointIndex\n\t\t\tstate = closeEditors(state)\n\n\t\t\tif (state.mode && state.mode.mode === 'DRAW_POLYGON' && pointIndex === 0) {\n\t\t\t\treturn setIn(modifyRegion(polygon, {\n\t\t\t\t\tpoints: polygon.points.slice(0, -1),\n\t\t\t\t\topen: false\n\t\t\t\t}), ['mode'], null)\n\t\t\t} else {\n\t\t\t\tstate = saveToHistory(state, 'Move Polygon Point')\n\t\t\t}\n\n\t\t\treturn setIn(state, ['mode'], {\n\t\t\t\tmode: 'MOVE_POLYGON_POINT',\n\t\t\t\tregionId: polygon.id,\n\t\t\t\tpointIndex: pointIndex\n\t\t\t})\n\t\t}\n\n\tcase 'BEGIN_MOVE_KEYPOINT':\n\t\t{\n\t\t\tvar _region = action.region,\n\t\t\t\tkeypointId = action.keypointId\n\t\t\tstate = closeEditors(state)\n\t\t\tstate = saveToHistory(state, 'Move Keypoint')\n\t\t\treturn setIn(state, ['mode'], {\n\t\t\t\tmode: 'MOVE_KEYPOINT',\n\t\t\t\tregionId: _region.id,\n\t\t\t\tkeypointId: keypointId\n\t\t\t})\n\t\t}\n\n\tcase 'ADD_POLYGON_POINT':\n\t\t{\n\t\t\tvar _polygon = action.polygon,\n\t\t\t\tpoint = action.point,\n\t\t\t\t_pointIndex = action.pointIndex\n\n\t\t\tvar _regionIndex2 = getRegionIndex(_polygon)\n\n\t\t\tif (_regionIndex2 === null) return state\n\n\t\t\tvar points = _toConsumableArray(_polygon.points)\n\n\t\t\tpoints.splice(_pointIndex, 0, point)\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex2]), _objectSpread({}, _polygon, {\n\t\t\t\tpoints: points\n\t\t\t}))\n\t\t}\n\n\tcase 'MOUSE_MOVE':\n\t\t{\n\t\t\tvar x = action.x,\n\t\t\t\ty = action.y\n\t\t\tif (!state.mode) return state\n\t\t\tif (!activeImage) return state\n\t\t\tvar _state = state,\n\t\t\t\tmouseDownAt = _state.mouseDownAt\n\n\t\t\tswitch (state.mode.mode) {\n\t\t\tcase 'MOVE_POLYGON_POINT':\n\t\t\t\t{\n\t\t\t\t\tvar _state$mode = state.mode,\n\t\t\t\t\t\t_pointIndex2 = _state$mode.pointIndex,\n\t\t\t\t\t\tregionId = _state$mode.regionId\n\n\t\t\t\t\tvar _regionIndex3 = getRegionIndex(regionId)\n\n\t\t\t\t\tif (_regionIndex3 === null) return state\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex3, 'points', _pointIndex2]), [x, y])\n\t\t\t\t}\n\n\t\t\tcase 'MOVE_KEYPOINT':\n\t\t\t\t{\n\t\t\t\t\tvar _state$mode2 = state.mode,\n\t\t\t\t\t\t_keypointId = _state$mode2.keypointId,\n\t\t\t\t\t\t_regionId = _state$mode2.regionId\n\n\t\t\t\t\tvar _getRegion3 = getRegion(_regionId),\n\t\t\t\t\t\t_getRegion4 = _slicedToArray(_getRegion3, 2),\n\t\t\t\t\t\t_region2 = _getRegion4[0],\n\t\t\t\t\t\t_regionIndex4 = _getRegion4[1]\n\n\t\t\t\t\tif (_regionIndex4 === null) return state\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex4, 'points', _keypointId]), _objectSpread({}, _region2.points[_keypointId], {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y\n\t\t\t\t\t}))\n\t\t\t\t}\n\n\t\t\tcase 'MOVE_REGION':\n\t\t\t\t{\n\t\t\t\t\tvar _regionId2 = state.mode.regionId\n\n\t\t\t\t\tif (_regionId2 === '$$allowed_area') {\n\t\t\t\t\t\tvar _state2 = state,\n\t\t\t\t\t\t\t_state2$allowedArea = _state2.allowedArea,\n\t\t\t\t\t\t\tw = _state2$allowedArea.w,\n\t\t\t\t\t\t\th = _state2$allowedArea.h\n\t\t\t\t\t\treturn setIn(state, ['allowedArea'], {\n\t\t\t\t\t\t\tx: x - w / 2,\n\t\t\t\t\t\t\ty: y - h / 2,\n\t\t\t\t\t\t\tw: w,\n\t\t\t\t\t\t\th: h\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tvar _regionIndex5 = getRegionIndex(_regionId2)\n\n\t\t\t\t\tif (_regionIndex5 === null) return state\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex5]), moveRegion(activeImage.regions[_regionIndex5], x, y))\n\t\t\t\t}\n\n\t\t\tcase 'RESIZE_BOX':\n\t\t\t\t{\n\t\t\t\t\tvar _state$mode3 = state.mode,\n\t\t\t\t\t\t_regionId3 = _state$mode3.regionId,\n\t\t\t\t\t\t_state$mode3$freedom = _slicedToArray(_state$mode3.freedom, 2),\n\t\t\t\t\t\txFree = _state$mode3$freedom[0],\n\t\t\t\t\t\tyFree = _state$mode3$freedom[1],\n\t\t\t\t\t\t_state$mode3$original = _state$mode3.original,\n\t\t\t\t\t\tox = _state$mode3$original.x,\n\t\t\t\t\t\toy = _state$mode3$original.y,\n\t\t\t\t\t\tow = _state$mode3$original.w,\n\t\t\t\t\t\toh = _state$mode3$original.h\n\n\t\t\t\t\tvar dx = xFree === 0 ? ox : xFree === -1 ? Math.min(ox + ow, x) : ox\n\t\t\t\t\tvar dw = xFree === 0 ? ow : xFree === -1 ? ow + (ox - dx) : Math.max(0, ow + (x - ox - ow))\n\t\t\t\t\tvar dy = yFree === 0 ? oy : yFree === -1 ? Math.min(oy + oh, y) : oy\n\t\t\t\t\tvar dh = yFree === 0 ? oh : yFree === -1 ? oh + (oy - dy) : Math.max(0, oh + (y - oy - oh)) // determine if we should switch the freedom\n\n\t\t\t\t\tif (dw <= 0.001) {\n\t\t\t\t\t\tstate = setIn(state, ['mode', 'freedom'], [xFree * -1, yFree])\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dh <= 0.001) {\n\t\t\t\t\t\tstate = setIn(state, ['mode', 'freedom'], [xFree, yFree * -1])\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_regionId3 === '$$allowed_area') {\n\t\t\t\t\t\treturn setIn(state, ['allowedArea'], {\n\t\t\t\t\t\t\tx: dx,\n\t\t\t\t\t\t\tw: dw,\n\t\t\t\t\t\t\ty: dy,\n\t\t\t\t\t\t\th: dh\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tvar _regionIndex6 = getRegionIndex(_regionId3)\n\n\t\t\t\t\tif (_regionIndex6 === null) return state\n\t\t\t\t\tvar _box = activeImage.regions[_regionIndex6]\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex6]), _objectSpread({}, _box, {\n\t\t\t\t\t\tx: dx,\n\t\t\t\t\t\tw: dw,\n\t\t\t\t\t\ty: dy,\n\t\t\t\t\t\th: dh\n\t\t\t\t\t}))\n\t\t\t\t}\n\n\t\t\tcase 'RESIZE_KEYPOINTS':\n\t\t\t\t{\n\t\t\t\t\tvar _state$mode4 = state.mode,\n\t\t\t\t\t\t_regionId4 = _state$mode4.regionId,\n\t\t\t\t\t\tlandmarks = _state$mode4.landmarks,\n\t\t\t\t\t\tcenterX = _state$mode4.centerX,\n\t\t\t\t\t\tcenterY = _state$mode4.centerY\n\t\t\t\t\tvar distFromCenter = Math.sqrt(Math.pow(centerX - x, 2) + Math.pow(centerY - y, 2))\n\t\t\t\t\tvar scale = distFromCenter / 0.15\n\t\t\t\t\treturn modifyRegion(_regionId4, {\n\t\t\t\t\t\tpoints: getLandmarksWithTransform({\n\t\t\t\t\t\t\tlandmarks: landmarks,\n\t\t\t\t\t\t\tcenter: {\n\t\t\t\t\t\t\t\tx: centerX,\n\t\t\t\t\t\t\t\ty: centerY\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tscale: scale\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\tcase 'DRAW_POLYGON':\n\t\t\t\t{\n\t\t\t\t\tvar _regionId5 = state.mode.regionId\n\n\t\t\t\t\tvar _getRegion5 = getRegion(_regionId5),\n\t\t\t\t\t\t_getRegion6 = _slicedToArray(_getRegion5, 2),\n\t\t\t\t\t\t_region3 = _getRegion6[0],\n\t\t\t\t\t\t_regionIndex7 = _getRegion6[1]\n\n\t\t\t\t\tif (!_region3) return setIn(state, ['mode'], null)\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex7, 'points', _region3.points.length - 1]), [x, y])\n\t\t\t\t}\n\n\t\t\tcase 'DRAW_LINE':\n\t\t\t\t{\n\t\t\t\t\tvar _regionId6 = state.mode.regionId\n\n\t\t\t\t\tvar _getRegion7 = getRegion(_regionId6),\n\t\t\t\t\t\t_getRegion8 = _slicedToArray(_getRegion7, 2),\n\t\t\t\t\t\t_region4 = _getRegion8[0],\n\t\t\t\t\t\t_regionIndex8 = _getRegion8[1]\n\n\t\t\t\t\tif (!_region4) return setIn(state, ['mode'], null)\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex8]), _objectSpread({}, _region4, {\n\t\t\t\t\t\tx2: x,\n\t\t\t\t\t\ty2: y\n\t\t\t\t\t}))\n\t\t\t\t}\n\n\t\t\tcase 'DRAW_EXPANDING_LINE':\n\t\t\t\t{\n\t\t\t\t\tvar _regionId7 = state.mode.regionId\n\n\t\t\t\t\tvar _getRegion9 = getRegion(_regionId7),\n\t\t\t\t\t\t_getRegion10 = _slicedToArray(_getRegion9, 2),\n\t\t\t\t\t\texpandingLine = _getRegion10[0],\n\t\t\t\t\t\t_regionIndex9 = _getRegion10[1]\n\n\t\t\t\t\tif (!expandingLine) return state\n\t\t\t\t\tvar isMouseDown = Boolean(state.mouseDownAt)\n\n\t\t\t\t\tif (isMouseDown) {\n                // If the mouse is down, set width/angle\n\t\t\t\t\t\tvar lastPoint = expandingLine.points.slice(-1)[0]\n\t\t\t\t\t\tvar mouseDistFromLastPoint = Math.sqrt(Math.pow(lastPoint.x - x, 2) + Math.pow(lastPoint.y - y, 2))\n\t\t\t\t\t\tif (mouseDistFromLastPoint < 0.002 && !lastPoint.width) return state\n\n\t\t\t\t\t\tvar _newState = setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex9, 'points']), expandingLine.points.slice(0, -1).concat([_objectSpread({}, lastPoint, {\n\t\t\t\t\t\t\twidth: mouseDistFromLastPoint * 2,\n\t\t\t\t\t\t\tangle: Math.atan2(lastPoint.x - x, lastPoint.y - y)\n\t\t\t\t\t\t})]))\n\n\t\t\t\t\t\treturn _newState\n\t\t\t\t\t} else {\n                // If mouse is up, move the next candidate point\n\t\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex9]), _objectSpread({}, expandingLine, {\n\t\t\t\t\t\t\tcandidatePoint: {\n\t\t\t\t\t\t\t\tx: x,\n\t\t\t\t\t\t\t\ty: y\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}))\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\tcase 'SET_EXPANDING_LINE_WIDTH':\n\t\t\t\t{\n\t\t\t\t\tvar _regionId8 = state.mode.regionId\n\n\t\t\t\t\tvar _getRegion11 = getRegion(_regionId8),\n\t\t\t\t\t\t_getRegion12 = _slicedToArray(_getRegion11, 2),\n\t\t\t\t\t\t_expandingLine = _getRegion12[0],\n\t\t\t\t\t\t_regionIndex10 = _getRegion12[1]\n\n\t\t\t\t\tif (!_expandingLine) return state\n\n\t\t\t\t\tvar _lastPoint = _expandingLine.points.slice(-1)[0]\n\n\t\t\t\t\tvar _state3 = state,\n\t\t\t\t\t\t_mouseDownAt = _state3.mouseDownAt\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex10, 'expandingWidth']), Math.sqrt(Math.pow(_lastPoint.x - x, 2) + Math.pow(_lastPoint.y - y, 2)))\n\t\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\treturn state\n\t\t\t}\n\t\t}\n\n\tcase 'MOUSE_DOWN':\n\t\t{\n\t\t\tvar _state$selectedCls\n\n\t\t\tif (!activeImage) return state\n\t\t\tvar _x = action.x,\n\t\t\t\t_y = action.y\n\t\t\tstate = setIn(state, ['mouseDownAt'], {\n\t\t\t\tx: _x,\n\t\t\t\ty: _y\n\t\t\t})\n\n\t\t\tif (state.mode) {\n\t\t\t\tswitch (state.mode.mode) {\n\t\t\t\tcase 'DRAW_POLYGON':\n\t\t\t\t\t{\n\t\t\t\t\t\tvar _getRegion13 = getRegion(state.mode.regionId),\n\t\t\t\t\t\t\t_getRegion14 = _slicedToArray(_getRegion13, 2),\n\t\t\t\t\t\t\t_polygon2 = _getRegion14[0],\n\t\t\t\t\t\t\t_regionIndex11 = _getRegion14[1]\n\n\t\t\t\t\t\tif (!_polygon2) break\n\t\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex11]), _objectSpread({}, _polygon2, {\n\t\t\t\t\t\t\tpoints: _polygon2.points.concat([[_x, _y]])\n\t\t\t\t\t\t}))\n\t\t\t\t\t}\n\n\t\t\t\tcase 'DRAW_LINE':\n\t\t\t\t\t{\n\t\t\t\t\t\tvar _getRegion15 = getRegion(state.mode.regionId),\n\t\t\t\t\t\t\t_getRegion16 = _slicedToArray(_getRegion15, 2),\n\t\t\t\t\t\t\tline = _getRegion16[0],\n\t\t\t\t\t\t\t_regionIndex12 = _getRegion16[1]\n\n\t\t\t\t\t\tif (!line) break\n\t\t\t\t\t\tsetIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex12]), _objectSpread({}, line, {\n\t\t\t\t\t\t\tx2: _x,\n\t\t\t\t\t\t\ty2: _y\n\t\t\t\t\t\t}))\n\t\t\t\t\t\treturn setIn(state, ['mode'], null)\n\t\t\t\t\t}\n\n\t\t\t\tcase 'DRAW_EXPANDING_LINE':\n\t\t\t\t\t{\n\t\t\t\t\t\tvar _getRegion17 = getRegion(state.mode.regionId),\n\t\t\t\t\t\t\t_getRegion18 = _slicedToArray(_getRegion17, 2),\n\t\t\t\t\t\t\t_expandingLine2 = _getRegion18[0],\n\t\t\t\t\t\t\t_regionIndex13 = _getRegion18[1]\n\n\t\t\t\t\t\tif (!_expandingLine2) break\n\n\t\t\t\t\t\tvar _lastPoint2 = _expandingLine2.points.slice(-1)[0]\n\n\t\t\t\t\t\tif (_expandingLine2.points.length > 1 && Math.sqrt(Math.pow(_lastPoint2.x - _x, 2) + Math.pow(_lastPoint2.y - _y, 2)) < 0.002) {\n\t\t\t\t\t\t\tif (!_lastPoint2.width) {\n\t\t\t\t\t\t\t\treturn setIn(state, ['mode'], {\n\t\t\t\t\t\t\t\t\tmode: 'SET_EXPANDING_LINE_WIDTH',\n\t\t\t\t\t\t\t\t\tregionId: state.mode.regionId\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn state.setIn([].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex13]), convertExpandingLineToPolygon(_expandingLine2)).setIn(['mode'], null)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} // Create new point\n\n\n\t\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex13, 'points']), _expandingLine2.points.concat([{\n\t\t\t\t\t\t\tx: _x,\n\t\t\t\t\t\t\ty: _y,\n\t\t\t\t\t\t\tangle: null,\n\t\t\t\t\t\t\twidth: null\n\t\t\t\t\t\t}]))\n\t\t\t\t\t}\n\n\t\t\t\tcase 'SET_EXPANDING_LINE_WIDTH':\n\t\t\t\t\t{\n\t\t\t\t\t\tvar _getRegion19 = getRegion(state.mode.regionId),\n\t\t\t\t\t\t\t_getRegion20 = _slicedToArray(_getRegion19, 2),\n\t\t\t\t\t\t\t_expandingLine3 = _getRegion20[0],\n\t\t\t\t\t\t\t_regionIndex14 = _getRegion20[1]\n\n\t\t\t\t\t\tif (!_expandingLine3) break\n\t\t\t\t\t\tvar expandingWidth = _expandingLine3.expandingWidth\n\t\t\t\t\t\treturn state.setIn([].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex14]), convertExpandingLineToPolygon(_objectSpread({}, _expandingLine3, {\n\t\t\t\t\t\t\tpoints: _expandingLine3.points.map(function (p) {\n\t\t\t\t\t\t\t\treturn p.width ? p : _objectSpread({}, p, {\n\t\t\t\t\t\t\t\t\twidth: expandingWidth\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\texpandingWidth: undefined\n\t\t\t\t\t\t}))).setIn(['mode'], null)\n\t\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar newRegion\n\t\t\tvar defaultRegionCls = state.selectedCls,\n\t\t\t\tdefaultRegionColor = ((_state$selectedCls = state.selectedCls) === null || _state$selectedCls === void 0 ? void 0 : _state$selectedCls.color) || colors[0]\n\n\t\t\tvar _clsIndex = (state.regionClsList || []).indexOf(defaultRegionCls)\n\n\t\t\tif (_clsIndex !== -1) {\n\t\t\t\tdefaultRegionColor = state.selectedCls.color\n\t\t\t}\n\n\t\t\tswitch (state.selectedTool) {\n\t\t\tcase 'create-point':\n\t\t\t\t{\n\t\t\t\t\tstate = saveToHistory(state, 'Create Point')\n\t\t\t\t\tnewRegion = {\n\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\tx: _x,\n\t\t\t\t\t\ty: _y,\n\t\t\t\t\t\thighlighted: true,\n\t\t\t\t\t\teditingLabels: true,\n\t\t\t\t\t\tcolor: defaultRegionColor,\n\t\t\t\t\t\tid: getRandomId(),\n\t\t\t\t\t\tcls: defaultRegionCls\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\tcase 'create-box':\n\t\t\t\t{\n\t\t\t\t\tstate = saveToHistory(state, 'Create Box')\n\t\t\t\t\tnewRegion = {\n\t\t\t\t\t\ttype: 'box',\n\t\t\t\t\t\tx: _x,\n\t\t\t\t\t\ty: _y,\n\t\t\t\t\t\tw: 0,\n\t\t\t\t\t\th: 0,\n\t\t\t\t\t\thighlighted: true,\n\t\t\t\t\t\teditingLabels: false,\n\t\t\t\t\t\tcolor: defaultRegionColor,\n\t\t\t\t\t\tcls: defaultRegionCls,\n\t\t\t\t\t\tid: getRandomId()\n\t\t\t\t\t}\n\t\t\t\t\tstate = setIn(state, ['mode'], {\n\t\t\t\t\t\tmode: 'RESIZE_BOX',\n\t\t\t\t\t\teditLabelEditorAfter: true,\n\t\t\t\t\t\tregionId: newRegion.id,\n\t\t\t\t\t\tfreedom: [1, 1],\n\t\t\t\t\t\toriginal: {\n\t\t\t\t\t\t\tx: _x,\n\t\t\t\t\t\t\ty: _y,\n\t\t\t\t\t\t\tw: newRegion.w,\n\t\t\t\t\t\t\th: newRegion.h\n\t\t\t\t\t\t},\n\t\t\t\t\t\tisNew: true\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\tcase 'create-polygon':\n\t\t\t\t{\n\t\t\t\t\tif (state.mode && state.mode.mode === 'DRAW_POLYGON') break\n\t\t\t\t\tstate = saveToHistory(state, 'Create Polygon')\n\t\t\t\t\tnewRegion = {\n\t\t\t\t\t\ttype: 'polygon',\n\t\t\t\t\t\tpoints: [[_x, _y], [_x, _y]],\n\t\t\t\t\t\topen: true,\n\t\t\t\t\t\thighlighted: true,\n\t\t\t\t\t\tcolor: defaultRegionColor,\n\t\t\t\t\t\tcls: defaultRegionCls,\n\t\t\t\t\t\tid: getRandomId()\n\t\t\t\t\t}\n\t\t\t\t\tstate = setIn(state, ['mode'], {\n\t\t\t\t\t\tmode: 'DRAW_POLYGON',\n\t\t\t\t\t\tregionId: newRegion.id\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\tcase 'create-expanding-line':\n\t\t\t\t{\n\t\t\t\t\tstate = saveToHistory(state, 'Create Expanding Line')\n\t\t\t\t\tnewRegion = {\n\t\t\t\t\t\ttype: 'expanding-line',\n\t\t\t\t\t\tunfinished: true,\n\t\t\t\t\t\tpoints: [{\n\t\t\t\t\t\t\tx: _x,\n\t\t\t\t\t\t\ty: _y,\n\t\t\t\t\t\t\tangle: null,\n\t\t\t\t\t\t\twidth: null\n\t\t\t\t\t\t}],\n\t\t\t\t\t\topen: true,\n\t\t\t\t\t\thighlighted: true,\n\t\t\t\t\t\tcolor: defaultRegionColor,\n\t\t\t\t\t\tcls: defaultRegionCls,\n\t\t\t\t\t\tid: getRandomId()\n\t\t\t\t\t}\n\t\t\t\t\tstate = setIn(state, ['mode'], {\n\t\t\t\t\t\tmode: 'DRAW_EXPANDING_LINE',\n\t\t\t\t\t\tregionId: newRegion.id\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\tcase 'create-line':\n\t\t\t\t{\n\t\t\t\t\tif (state.mode && state.mode.mode === 'DRAW_LINE') break\n\t\t\t\t\tstate = saveToHistory(state, 'Create Line')\n\t\t\t\t\tnewRegion = {\n\t\t\t\t\t\ttype: 'line',\n\t\t\t\t\t\tx1: _x,\n\t\t\t\t\t\ty1: _y,\n\t\t\t\t\t\tx2: _x,\n\t\t\t\t\t\ty2: _y,\n\t\t\t\t\t\thighlighted: true,\n\t\t\t\t\t\teditingLabels: false,\n\t\t\t\t\t\tcolor: defaultRegionColor,\n\t\t\t\t\t\tcls: defaultRegionCls,\n\t\t\t\t\t\tid: getRandomId()\n\t\t\t\t\t}\n\t\t\t\t\tstate = setIn(state, ['mode'], {\n\t\t\t\t\t\tmode: 'DRAW_LINE',\n\t\t\t\t\t\tregionId: newRegion.id\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\tcase 'create-keypoints':\n\t\t\t\t{\n\t\t\t\t\tstate = saveToHistory(state, 'Create Keypoints')\n\n\t\t\t\t\tvar _ref2 = Object.entries(state.keypointDefinitions),\n\t\t\t\t\t\t_ref3 = _slicedToArray(_ref2, 1),\n\t\t\t\t\t\t_ref3$ = _slicedToArray(_ref3[0], 2),\n\t\t\t\t\t\tkeypointsDefinitionId = _ref3$[0],\n\t\t\t\t\t\t_ref3$$ = _ref3$[1],\n\t\t\t\t\t\t_landmarks = _ref3$$.landmarks,\n\t\t\t\t\t\tconnections = _ref3$$.connections\n\n\t\t\t\t\tnewRegion = {\n\t\t\t\t\t\ttype: 'keypoints',\n\t\t\t\t\t\tkeypointsDefinitionId: keypointsDefinitionId,\n\t\t\t\t\t\tpoints: getLandmarksWithTransform({\n\t\t\t\t\t\t\tlandmarks: _landmarks,\n\t\t\t\t\t\t\tcenter: {\n\t\t\t\t\t\t\t\tx: _x,\n\t\t\t\t\t\t\t\ty: _y\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tscale: 1\n\t\t\t\t\t\t}),\n\t\t\t\t\t\thighlighted: true,\n\t\t\t\t\t\teditingLabels: false,\n\t\t\t\t\t\tid: getRandomId()\n\t\t\t\t\t}\n\t\t\t\t\tstate = setIn(state, ['mode'], {\n\t\t\t\t\t\tmode: 'RESIZE_KEYPOINTS',\n\t\t\t\t\t\tlandmarks: _landmarks,\n\t\t\t\t\t\tcenterX: _x,\n\t\t\t\t\t\tcenterY: _y,\n\t\t\t\t\t\tregionId: newRegion.id,\n\t\t\t\t\t\tisNew: true\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tvar _regions = _toConsumableArray(getIn(state, pathToActiveImage).regions || []).map(function (r) {\n\t\t\t\treturn setIn(r, ['editingLabels'], false).setIn(['highlighted'], false)\n\t\t\t}).concat(newRegion ? [newRegion] : [])\n\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), _regions)\n\t\t}\n\n\tcase 'MOUSE_UP':\n\t\t{\n\t\t\tvar _x2 = action.x,\n\t\t\t\t_y2 = action.y\n\n\t\t\tvar _state4 = state,\n\t\t\t\t_state4$mouseDownAt = _state4.mouseDownAt,\n\t\t\t\t_mouseDownAt2 = _state4$mouseDownAt === void 0 ? {\n\t\t\t\t\tx: _x2,\n\t\t\t\t\ty: _y2\n\t\t\t\t} : _state4$mouseDownAt\n\n\t\t\tif (!state.mode) return state\n\t\t\tstate = setIn(state, ['mouseDownAt'], null)\n\n\t\t\tswitch (state.mode.mode) {\n\t\t\tcase 'RESIZE_BOX':\n\t\t\t\t{\n\t\t\t\t\tif (state.mode.isNew) {\n\t\t\t\t\t\tif (Math.abs(state.mode.original.x - _x2) < 0.002 || Math.abs(state.mode.original.y - _y2) < 0.002) {\n\t\t\t\t\t\t\treturn setIn(modifyRegion(state.mode.regionId, null), ['mode'], null)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.mode.editLabelEditorAfter) {\n\t\t\t\t\t\treturn _objectSpread({}, modifyRegion(state.mode.regionId, {\n\t\t\t\t\t\t\teditingLabels: true\n\t\t\t\t\t\t}), {\n\t\t\t\t\t\t\tmode: null\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\n\t\t\tcase 'MOVE_REGION':\n\t\t\t\tbreak\n\t\t\tcase 'RESIZE_KEYPOINTS':\n\t\t\t\tbreak\n\t\t\tcase 'MOVE_POLYGON_POINT':\n\t\t\t\t{\n\t\t\t\t\treturn _objectSpread({}, state, {\n\t\t\t\t\t\tmode: null\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\tcase 'MOVE_KEYPOINT':\n\t\t\t\t{\n\t\t\t\t\treturn _objectSpread({}, state, {\n\t\t\t\t\t\tmode: null\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\tcase 'CREATE_POINT_LINE':\n\t\t\t\t{\n\t\t\t\t\treturn state\n\t\t\t\t}\n\n\t\t\tcase 'DRAW_EXPANDING_LINE':\n\t\t\t\t{\n\t\t\t\t\tvar _getRegion21 = getRegion(state.mode.regionId),\n\t\t\t\t\t\t_getRegion22 = _slicedToArray(_getRegion21, 2),\n\t\t\t\t\t\t_expandingLine4 = _getRegion22[0],\n\t\t\t\t\t\t_regionIndex15 = _getRegion22[1]\n\n\t\t\t\t\tif (!_expandingLine4) return state\n\t\t\t\t\tvar newExpandingLine = _expandingLine4\n\n\t\t\t\t\tvar _lastPoint3 = _expandingLine4.points.length !== 0 ? _expandingLine4.points.slice(-1)[0] : _mouseDownAt2\n\n\t\t\t\t\tvar jointStart\n\n\t\t\t\t\tif (_expandingLine4.points.length > 1) {\n\t\t\t\t\t\tjointStart = _expandingLine4.points.slice(-2)[0]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tjointStart = _lastPoint3\n\t\t\t\t\t}\n\n\t\t\t\t\tvar _mouseDistFromLastPoint = Math.sqrt(Math.pow(_lastPoint3.x - _x2, 2) + Math.pow(_lastPoint3.y - _y2, 2))\n\n\t\t\t\t\tif (_mouseDistFromLastPoint > 0.002) {\n                // The user is drawing has drawn the width for the last point\n\t\t\t\t\t\tvar newPoints = _toConsumableArray(_expandingLine4.points)\n\n\t\t\t\t\t\tfor (var i = 0; i < newPoints.length - 1; i++) {\n\t\t\t\t\t\t\tif (newPoints[i].width) continue\n\t\t\t\t\t\t\tnewPoints[i] = _objectSpread({}, newPoints[i], {\n\t\t\t\t\t\t\t\twidth: _lastPoint3.width\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnewExpandingLine = setIn(_expandingLine4, ['points'], fixTwisted(newPoints))\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn state\n\t\t\t\t\t}\n\n\t\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex15]), newExpandingLine)\n\t\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\treturn state\n\t\t\t}\n\t\t}\n\n\t\tbreak\n\t\t\n\tcase 'OPEN_REGION_EDITOR':\n\t\t{\n\t\t\tvar _region5 = action.region\n\n\t\t\tvar _regionIndex16 = getRegionIndex(action.region)\n\n\t\t\tif (_regionIndex16 === null) return state\n\t\t\tvar newRegions = setIn(activeImage.regions.map(function (r) {\n\t\t\t\treturn _objectSpread({}, r, {\n\t\t\t\t\thighlighted: false,\n\t\t\t\t\teditingLabels: false\n\t\t\t\t})\n\t\t\t}), [_regionIndex16], _objectSpread({}, (activeImage.regions || [])[_regionIndex16], {\n\t\t\t\thighlighted: true,\n\t\t\t\teditingLabels: true\n\t\t\t}))\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), newRegions)\n\t\t}\n\n\tcase 'CLOSE_REGION_EDITOR':\n\t\t{\n\t\t\tvar _region6 = action.region\n\n\t\t\tvar _regionIndex17 = getRegionIndex(action.region)\n\n\t\t\tif (_regionIndex17 === null) return state\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions', _regionIndex17]), _objectSpread({}, (activeImage.regions || [])[_regionIndex17], {\n\t\t\t\teditingLabels: false\n\t\t\t}))\n\t\t}\n\n\tcase 'DELETE_REGION':\n\t\t{\n\t\t\tvar _regionIndex18 = getRegionIndex(action.region)\n\n\t\t\tif (_regionIndex18 === null) return state\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), (activeImage.regions || []).filter(function (r) {\n\t\t\t\treturn r.id !== action.region.id\n\t\t\t}))\n\t\t}\n\n\tcase 'DELETE_SELECTED_REGION':\n\t\t{\n\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), (activeImage.regions || []).filter(function (r) {\n\t\t\t\treturn !r.highlighted\n\t\t\t}))\n\t\t}\n\n\tcase 'HEADER_BUTTON_CLICKED':\n\t\t{\n\t\t\tvar buttonName = action.buttonName.toLowerCase()\n\n\t\t\tswitch (buttonName) {\n\t\t\tcase 'prev':\n\t\t\t\t{\n\t\t\t\t\tif (currentImageIndex === null) return state\n\t\t\t\t\tif (currentImageIndex === 0) return state\n\t\t\t\t\treturn setNewImage(state.images[currentImageIndex - 1], currentImageIndex - 1)\n\t\t\t\t}\n\n\t\t\tcase 'next':\n\t\t\t\t{\n\t\t\t\t\tif (currentImageIndex === null) return state\n\t\t\t\t\tif (currentImageIndex === state.images.length - 1) return state\n\t\t\t\t\treturn setNewImage(state.images[currentImageIndex + 1], currentImageIndex + 1)\n\t\t\t\t}\n\n\t\t\tcase 'clone':\n\t\t\t\t{\n\t\t\t\t\tif (currentImageIndex === null) return state\n\t\t\t\t\tif (currentImageIndex === state.images.length - 1) return state\n\t\t\t\t\treturn setIn(setNewImage(state.images[currentImageIndex + 1], currentImageIndex + 1), ['images', currentImageIndex + 1, 'regions'], activeImage.regions)\n\t\t\t\t}\n\n\t\t\tcase 'settings':\n\t\t\t\t{\n\t\t\t\t\treturn setIn(state, ['settingsOpen'], !state.settingsOpen)\n\t\t\t\t}\n\n\t\t\tcase 'help':\n\t\t\t\t{\n\t\t\t\t\treturn state\n\t\t\t\t}\n\n\t\t\tcase 'fullscreen':\n\t\t\t\t{\n\t\t\t\t\treturn setIn(state, ['fullScreen'], true)\n\t\t\t\t}\n\n\t\t\tcase 'exit fullscreen':\n\t\t\tcase 'window':\n\t\t\t\t{\n\t\t\t\t\treturn setIn(state, ['fullScreen'], false)\n\t\t\t\t}\n\n\t\t\tcase 'hotkeys':\n\t\t\t\t{\n\t\t\t\t\treturn state\n\t\t\t\t}\n\n\t\t\tcase 'exit':\n\t\t\tcase 'done':\n\t\t\t\t{\n\t\t\t\t\treturn state\n\t\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\treturn state\n\t\t\t}\n\t\t}\n\n\tcase 'SELECT_TOOL':\n\t\t{\n\t\t\tif (action.selectedTool === 'show-tags') {\n\t\t\t\tsetInLocalStorage('showTags', !state.showTags)\n\t\t\t\treturn setIn(state, ['showTags'], !state.showTags)\n\t\t\t} else if (action.selectedTool === 'show-mask') {\n\t\t\t\treturn setIn(state, ['showMask'], !state.showMask)\n\t\t\t}\n\n\t\t\tif (action.selectedTool === 'modify-allowed-area' && !state.allowedArea) {\n\t\t\t\tstate = setIn(state, ['allowedArea'], {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tw: 1,\n\t\t\t\t\th: 1\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tstate = setIn(state, ['mode'], null)\n\t\t\treturn setIn(state, ['selectedTool'], action.selectedTool)\n\t\t}\n\n\tcase 'CANCEL':\n\t\t{\n\t\t\tvar _state5 = state,\n\t\t\t\tmode = _state5.mode\n\n\t\t\tif (mode) {\n\t\t\t\tswitch (mode.mode) {\n\t\t\t\tcase 'DRAW_EXPANDING_LINE':\n\t\t\t\tcase 'SET_EXPANDING_LINE_WIDTH':\n\t\t\t\tcase 'DRAW_POLYGON':\n\t\t\t\t\t{\n\t\t\t\t\t\tvar _regionId9 = mode.regionId\n\t\t\t\t\t\treturn modifyRegion(_regionId9, null)\n\t\t\t\t\t}\n\n\t\t\t\tcase 'MOVE_POLYGON_POINT':\n\t\t\t\tcase 'RESIZE_BOX':\n\t\t\t\tcase 'MOVE_REGION':\n\t\t\t\t\t{\n\t\t\t\t\t\treturn setIn(state, ['mode'], null)\n\t\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t\treturn state\n\t\t\t\t}\n\t\t\t} // Close any open boxes\n\n\n\t\t\tvar _regions2 = activeImage.regions\n\n\t\t\tif (_regions2 && _regions2.some(function (r) {\n\t\t\t\treturn r.editingLabels\n\t\t\t})) {\n\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), _regions2.map(function (r) {\n\t\t\t\t\treturn _objectSpread({}, r, {\n\t\t\t\t\t\teditingLabels: false\n\t\t\t\t\t})\n\t\t\t\t}))\n\t\t\t} else if (_regions2) {\n\t\t\t\treturn setIn(state, [].concat(_toConsumableArray(pathToActiveImage), ['regions']), _regions2.map(function (r) {\n\t\t\t\t\treturn _objectSpread({}, r, {\n\t\t\t\t\t\thighlighted: false\n\t\t\t\t\t})\n\t\t\t\t}))\n\t\t\t}\n\n\t\t\tbreak\n\t\t}\n\n\tdefault:\n\t\tbreak\n\t}\n\n\treturn state\n})"],"mappings":"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"}
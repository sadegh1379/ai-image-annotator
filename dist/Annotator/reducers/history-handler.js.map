{"version":3,"file":"history-handler.js","names":["setIn","updateIn","asMutable","without","moment","typesToSaveWithHistory","BEGIN_BOX_TRANSFORM","BEGIN_MOVE_POINT","DELETE_REGION","saveToHistory","state","name","h","time","toDate","concat","slice","reducer","action","prevState","nextState","type","history","length","Object","keys","includes"],"sources":["../../../src/Annotator/reducers/history-handler.js"],"sourcesContent":["import { setIn, updateIn, asMutable, without } from 'seamless-immutable'\nimport moment from 'moment'\nvar typesToSaveWithHistory = {\n\tBEGIN_BOX_TRANSFORM: 'Transform/Move Box',\n\tBEGIN_MOVE_POINT: 'Move Point',\n\tDELETE_REGION: 'Delete Region'\n}\nexport var saveToHistory = function saveToHistory(state, name) {\n\treturn updateIn(state, ['history'], function (h) {\n\t\treturn [{\n\t\t\ttime: moment().toDate(),\n\t\t\tstate: without(state, 'history'),\n\t\t\tname: name\n\t\t}].concat((h || []).slice(0, 9))\n\t})\n}\nexport default (function (reducer) {\n\treturn function (state, action) {\n\t\tvar prevState = state\n\t\tvar nextState = reducer(state, action)\n\n\t\tif (action.type === 'RESTORE_HISTORY') {\n\t\t\tif (state.history.length > 0) {\n\t\t\t\treturn setIn(nextState.history[0].state, ['history'], nextState.history.slice(1))\n\t\t\t}\n\t\t} else {\n\t\t\tif (prevState !== nextState && Object.keys(typesToSaveWithHistory).includes(action.type)) {\n\t\t\t\treturn setIn(nextState, ['history'], [{\n\t\t\t\t\ttime: moment().toDate(),\n\t\t\t\t\tstate: without(prevState, 'history'),\n\t\t\t\t\tname: typesToSaveWithHistory[action.type] || action.type\n\t\t\t\t}].concat(nextState.history || []).slice(0, 9))\n\t\t\t}\n\t\t}\n\n\t\treturn nextState\n\t}\n})"],"mappings":"AAAA,SAASA,KAAT,EAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,OAArC,QAAoD,oBAApD;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,IAAIC,sBAAsB,GAAG;EAC5BC,mBAAmB,EAAE,oBADO;EAE5BC,gBAAgB,EAAE,YAFU;EAG5BC,aAAa,EAAE;AAHa,CAA7B;AAKA,OAAO,IAAIC,aAAa,GAAG,SAASA,aAAT,CAAuBC,KAAvB,EAA8BC,IAA9B,EAAoC;EAC9D,OAAOV,QAAQ,CAACS,KAAD,EAAQ,CAAC,SAAD,CAAR,EAAqB,UAAUE,CAAV,EAAa;IAChD,OAAO,CAAC;MACPC,IAAI,EAAET,MAAM,GAAGU,MAAT,EADC;MAEPJ,KAAK,EAAEP,OAAO,CAACO,KAAD,EAAQ,SAAR,CAFP;MAGPC,IAAI,EAAEA;IAHC,CAAD,EAIJI,MAJI,CAIG,CAACH,CAAC,IAAI,EAAN,EAAUI,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,CAJH,CAAP;EAKA,CANc,CAAf;AAOA,CARM;AASP,gBAAgB,UAAUC,OAAV,EAAmB;EAClC,OAAO,UAAUP,KAAV,EAAiBQ,MAAjB,EAAyB;IAC/B,IAAIC,SAAS,GAAGT,KAAhB;IACA,IAAIU,SAAS,GAAGH,OAAO,CAACP,KAAD,EAAQQ,MAAR,CAAvB;;IAEA,IAAIA,MAAM,CAACG,IAAP,KAAgB,iBAApB,EAAuC;MACtC,IAAIX,KAAK,CAACY,OAAN,CAAcC,MAAd,GAAuB,CAA3B,EAA8B;QAC7B,OAAOvB,KAAK,CAACoB,SAAS,CAACE,OAAV,CAAkB,CAAlB,EAAqBZ,KAAtB,EAA6B,CAAC,SAAD,CAA7B,EAA0CU,SAAS,CAACE,OAAV,CAAkBN,KAAlB,CAAwB,CAAxB,CAA1C,CAAZ;MACA;IACD,CAJD,MAIO;MACN,IAAIG,SAAS,KAAKC,SAAd,IAA2BI,MAAM,CAACC,IAAP,CAAYpB,sBAAZ,EAAoCqB,QAApC,CAA6CR,MAAM,CAACG,IAApD,CAA/B,EAA0F;QACzF,OAAOrB,KAAK,CAACoB,SAAD,EAAY,CAAC,SAAD,CAAZ,EAAyB,CAAC;UACrCP,IAAI,EAAET,MAAM,GAAGU,MAAT,EAD+B;UAErCJ,KAAK,EAAEP,OAAO,CAACgB,SAAD,EAAY,SAAZ,CAFuB;UAGrCR,IAAI,EAAEN,sBAAsB,CAACa,MAAM,CAACG,IAAR,CAAtB,IAAuCH,MAAM,CAACG;QAHf,CAAD,EAIlCN,MAJkC,CAI3BK,SAAS,CAACE,OAAV,IAAqB,EAJM,EAIFN,KAJE,CAII,CAJJ,EAIO,CAJP,CAAzB,CAAZ;MAKA;IACD;;IAED,OAAOI,SAAP;EACA,CAnBD;AAoBA,CArBD"}
{"version":3,"file":"index.js","names":["_slicedToArray","React","useRef","useEffect","useMemo","useState","styled","useEventCallback","useSettings","Video","zIndex","position","StyledImage","Error","left","right","bottom","top","backgroundColor","color","fontWeight","whiteSpace","padding","_ref","imagePosition","mouseEvents","videoTime","videoSrc","imageSrc","onLoad","onCanvasImageLoadSuccess","onCanvasImageLoadError","_ref$useCrossOrigin","useCrossOrigin","videoPlaying","onChangeVideoTime","onChangeVideoPlaying","settings","videoRef","imageRef","_useState","_useState2","error","setError","current","currentTime","renderLoopRunning","play","videoPlaybackSpeed","playbackRate","parseFloat","pause","checkForNewFrame","newVideoTime","Math","floor","paused","requestAnimationFrame","onLoadedVideoMetadata","event","videoElm","currentTarget","naturalWidth","videoWidth","naturalHeight","videoHeight","duration","onImageLoaded","imageElm","onImageError","stylePosition","width","bottomRight","x","topLeft","height","y","imageRendering","isNaN","createElement","undefined","Object","assign","src","ref","style","onError","crossOrigin","onLoadedMetadata"],"sources":["../../src/VideoOrImageCanvasBackground/index.js"],"sourcesContent":["import _slicedToArray from '@babel/runtime/helpers/esm/slicedToArray'\nimport React, { useRef, useEffect, useMemo, useState } from 'react'\nimport { styled } from '@material-ui/core/styles'\nimport useEventCallback from 'use-event-callback'\nimport { useSettings } from '../SettingsProvider'\nvar Video = styled('video')({\n\tzIndex: 0,\n\tposition: 'absolute'\n})\nvar StyledImage = styled('img')({\n\tzIndex: 0,\n\tposition: 'absolute'\n})\nvar Error = styled('div')({\n\tzIndex: 0,\n\tposition: 'absolute',\n\tleft: 0,\n\tright: 0,\n\tbottom: 0,\n\ttop: 0,\n\tbackgroundColor: 'rgba(255,0,0,0.2)',\n\tcolor: '#ff0000',\n\tfontWeight: 'bold',\n\twhiteSpace: 'pre-wrap',\n\tpadding: 50\n})\nexport default (function (_ref) {\n\tvar imagePosition = _ref.imagePosition,\n\t\tmouseEvents = _ref.mouseEvents,\n\t\tvideoTime = _ref.videoTime,\n\t\tvideoSrc = _ref.videoSrc,\n\t\timageSrc = _ref.imageSrc,\n\t\tonLoad = _ref.onLoad,\n\t\tonCanvasImageLoadSuccess = _ref.onCanvasImageLoadSuccess,\n\t\tonCanvasImageLoadError = _ref.onCanvasImageLoadError,\n\t\t_ref$useCrossOrigin = _ref.useCrossOrigin,\n\t\tuseCrossOrigin = _ref$useCrossOrigin === void 0 ? false : _ref$useCrossOrigin,\n\t\tvideoPlaying = _ref.videoPlaying,\n\t\tonChangeVideoTime = _ref.onChangeVideoTime,\n\t\tonChangeVideoPlaying = _ref.onChangeVideoPlaying\n\tvar settings = useSettings()\n\tvar videoRef = useRef()\n\tvar imageRef = useRef()\n\n\tvar _useState = useState(),\n\t\t_useState2 = _slicedToArray(_useState, 2),\n\t\terror = _useState2[0],\n\t\tsetError = _useState2[1]\n\n\tuseEffect(function () {\n\t\tif (!videoPlaying && videoRef.current) {\n\t\t\tvideoRef.current.currentTime = (videoTime || 0) / 1000\n\t\t}\n\t}, [videoTime])\n\tuseEffect(function () {\n\t\tvar renderLoopRunning = false\n\n\t\tif (videoRef.current) {\n\t\t\tif (videoPlaying) {\n\t\t\t\tvideoRef.current.play()\n\t\t\t\trenderLoopRunning = true\n\n\t\t\t\tif (settings.videoPlaybackSpeed) {\n\t\t\t\t\tvideoRef.current.playbackRate = parseFloat(settings.videoPlaybackSpeed)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvideoRef.current.pause()\n\t\t\t}\n\t\t}\n\n\t\tfunction checkForNewFrame() {\n\t\t\tif (!renderLoopRunning) return\n\t\t\tif (!videoRef.current) return\n\t\t\tvar newVideoTime = Math.floor(videoRef.current.currentTime * 1000)\n\n\t\t\tif (videoTime !== newVideoTime) {\n\t\t\t\tonChangeVideoTime(newVideoTime)\n\t\t\t}\n\n\t\t\tif (videoRef.current.paused) {\n\t\t\t\trenderLoopRunning = false\n\t\t\t\tonChangeVideoPlaying(false)\n\t\t\t}\n\n\t\t\trequestAnimationFrame(checkForNewFrame)\n\t\t}\n\n\t\tcheckForNewFrame()\n\t\treturn function () {\n\t\t\trenderLoopRunning = false\n\t\t}\n\t}, [videoPlaying])\n\tvar onLoadedVideoMetadata = useEventCallback(function (event) {\n\t\tvar videoElm = event.currentTarget\n\t\tvideoElm.currentTime = (videoTime || 0) / 1000\n\t\tif (onLoad) onLoad({\n\t\t\tnaturalWidth: videoElm.videoWidth,\n\t\t\tnaturalHeight: videoElm.videoHeight,\n\t\t\tvideoElm: videoElm,\n\t\t\tduration: videoElm.duration\n\t\t})\n\t})\n\tvar onImageLoaded = useEventCallback(function (event) {\n\t\tif (onCanvasImageLoadSuccess != null) {\n\t\t\tonCanvasImageLoadSuccess(event)\n\t\t}\n\n\t\tvar imageElm = event.currentTarget\n\t\tif (onLoad) onLoad({\n\t\t\tnaturalWidth: imageElm.naturalWidth,\n\t\t\tnaturalHeight: imageElm.naturalHeight,\n\t\t\timageElm: imageElm\n\t\t})\n\t})\n\tvar onImageError = useEventCallback(function (event) {\n\t\t// setError('Could not load image\\n\\nMake sure your image works by visiting '.concat(imageSrc || videoSrc, ' in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.').concat(!useCrossOrigin ? '' : '\\n\\nYour image may be blocked because it\\'s not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you\\'re using an S3 bucket or own the server hosting your images.', '\\n\\n If you need a hand, reach out to the community at universaldatatool.slack.com'))\n\t\tif (onCanvasImageLoadError != null) {\n\t\t\tonCanvasImageLoadError(event)\n\t\t}\n\t})\n\tvar stylePosition = useMemo(function () {\n\t\tvar width = imagePosition.bottomRight.x - imagePosition.topLeft.x\n\t\tvar height = imagePosition.bottomRight.y - imagePosition.topLeft.y\n\t\treturn {\n\t\t\timageRendering: 'pixelated',\n\t\t\tleft: imagePosition.topLeft.x,\n\t\t\ttop: imagePosition.topLeft.y,\n\t\t\twidth: isNaN(width) ? 0 : width,\n\t\t\theight: isNaN(height) ? 0 : height\n\t\t}\n\t}, [imagePosition.topLeft.x, imagePosition.topLeft.y, imagePosition.bottomRight.x, imagePosition.bottomRight.y])\n\tif (!videoSrc && !imageSrc) return React.createElement(Error, null, 'No imageSrc or videoSrc provided')\n\tif (error) return React.createElement(Error, null, error)\n\treturn imageSrc && videoTime === undefined ? React.createElement(StyledImage, Object.assign({}, mouseEvents, {\n\t\tsrc: imageSrc,\n\t\tref: imageRef,\n\t\tstyle: stylePosition,\n\t\tonLoad: onImageLoaded,\n\t\tonError: onImageError,\n\t\tcrossOrigin: useCrossOrigin ? 'anonymous' : undefined\n\t})) : React.createElement(Video, Object.assign({}, mouseEvents, {\n\t\tref: videoRef,\n\t\tstyle: stylePosition,\n\t\tonLoadedMetadata: onLoadedVideoMetadata,\n\t\tsrc: videoSrc || imageSrc\n\t}))\n})"],"mappings":"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"}